# Multiply a and b
# Put the result into registers 0 and 1

.CONST a 63
.CONST b 4099

..ROM 0
PUSH a
PUSH b
CALL mul
RETURN

.LABEL mul
POP r2
PUSH 0
DUP
DUP
POP r0
POP r1
POP r3
.LABEL mul_loop
RSH
.USEFLAGS
BRANCH !C mul_skip
# Add
PUSH r0
ADD r2
POP r0
PUSH r1
CADD r3
POP r1
.LABEL mul_skip
# Double
PUSH r2
ADD r2
POP r2
PUSH r3
CADD r3
POP r3
DUP
POPNOOP
.USEFLAGS
BRANCH !Z mul_loop
POPNOOP
PUSH r1
PUSH r0
OUTPUT 2
OUTPUT 2
RETURN